
<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="manifest" href="/manifest.json" />
    <meta name="theme-color" content="#4f46e5" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <script>
      // Essential Polyfills for legacy libraries compatibility
      window.global = window;
      window.process = { env: { NODE_ENV: 'production' } };
      // Polyfill module and exports to prevent 'exports is not defined' errors from legacy packages
      var exports = {};
      var module = { exports: exports };
      window.exports = exports;
      window.module = module;
      
      // Tailwind Config
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            colors: {
              slate: {
                50: '#f8fafc',
                100: '#f1f5f9',
                200: '#e2e8f0',
                300: '#cbd5e1',
                400: '#94a3b8',
                500: '#64748b',
                600: '#475569',
                700: '#334155',
                800: '#1e293b',
                900: '#0f172a',
              },
              indigo: {
                50: '#eef2ff',
                100: '#e0e7ff',
                200: '#c7d2fe',
                300: '#a5b4fc',
                400: '#818cf8',
                500: '#6366f1',
                600: '#4f46e5',
                700: '#4338ca',
                800: '#3730a3',
                900: '#312e81',
              }
            },
            fontFamily: {
              sans: ['Cairo', 'sans-serif'],
              en: ['Roboto', 'sans-serif'],
              cairo: ['Cairo', 'sans-serif'],
              roboto: ['Roboto', 'sans-serif'],
              tajawal: ['Tajawal', 'sans-serif'],
            },
          }
        }
      }
    </script>
    <style>
      body {
        background-color: #f1f5f9; /* slate-100 */
        transition: background-color 0.3s ease;
      }
      html.dark body {
        background-color: #0f172a; /* slate-900 */
      }
      html[lang="ar"] body, html[lang="ar"] input, html[lang="ar"] select, html[lang="ar"] textarea, html[lang="ar"] button {
        font-family: 'Cairo', sans-serif;
      }
      html[lang="en"] body, html[lang="en"] input, html[lang="en"] select, html[lang="en"] textarea, html[lang="en"] button,
      html[lang="tr"] body, html[lang="tr"] input, html[lang="tr"] select, html[lang="tr"] textarea, html[lang="tr"] button {
        font-family: 'Roboto', 'sans-serif';
      }
      
      /* Print Styles - CRITICAL FIX */
      @media print {
        @page { 
            size: auto; 
            margin: 0mm; 
        }
        html, body {
            height: auto !important;
            overflow: visible !important;
            background-color: white !important;
            color: black !important;
        }
        
        /* Hide everything by default, including the root app container */
        #root, #error-overlay {
            display: none !important;
        }

        /* Show only the print portal and ensure it flows naturally */
        #print-portal {
            display: block !important;
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: auto !important;
            overflow: visible !important;
            z-index: 9999;
            background: white !important;
        }
        
        /* Force visibility on all children of the print portal */
        #print-portal * {
             visibility: visible !important;
             -webkit-print-color-adjust: exact !important;
             print-color-adjust: exact !important;
             color: black !important; /* Ensure text is black for thermal printers */
        }

        .no-print { display: none !important; }
      }
    </style>
<script type="importmap">
{
  "imports": {
    "react/": "https://aistudiocdn.com/react@^19.2.1/",
    "react": "https://aistudiocdn.com/react@^19.2.1",
    "i18next": "https://aistudiocdn.com/i18next@^25.7.2",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.1/",
    "react-router-dom": "https://aistudiocdn.com/react-router-dom@^7.10.1",
    "dexie-react-hooks": "https://aistudiocdn.com/dexie-react-hooks@^4.2.0",
    "qrcode": "https://aistudiocdn.com/qrcode@^1.5.4",
    "@google/genai": "https://aistudiocdn.com/@google/genai@^1.31.0",
    "html2canvas": "https://aistudiocdn.com/html2canvas@^1.4.1",
    "@zxing/browser": "https://aistudiocdn.com/@zxing/browser@^0.1.5",
    "dexie": "https://aistudiocdn.com/dexie@^4.2.1",
    "vite": "https://aistudiocdn.com/vite@^7.2.7",
    "@vitejs/plugin-react": "https://aistudiocdn.com/@vitejs/plugin-react@^5.1.2",
    "express": "https://aistudiocdn.com/express@^5.2.1",
    "vite-plugin-pwa": "https://aistudiocdn.com/vite-plugin-pwa@^1.2.0",
    "@prisma/client": "https://aistudiocdn.com/@prisma/client@^7.1.0",
    "cors": "https://aistudiocdn.com/cors@^2.8.5",
    "react-dom": "https://aistudiocdn.com/react-dom@^19.2.1"
  }
}
</script>
<link rel="stylesheet" href="/index.css">
</head>
  <body>
    <div id="root">
        <div style="display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh; background-color: #f1f5f9; color: #64748b; font-family: sans-serif;">
            <div style="text-align: center;">
                <div style="width: 40px; height: 40px; border: 4px solid #4f46e5; border-top-color: transparent; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 16px;"></div>
                <p>Loading ProCount...</p>
            </div>
        </div>
    </div>
    <!-- Dedicated Print Portal Container -->
    <div id="print-portal"></div>
    
    <div id="error-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #fef2f2; z-index: 9999; flex-direction: column; align-items: center; justify-content: center; padding: 20px; text-align: center;">
        <h2 style="color: #991b1b; margin-bottom: 10px;">System Error</h2>
        <p style="color: #7f1d1d; margin-bottom: 20px;">The application encountered a critical error during initialization.</p>
        <pre id="error-message" style="color: #ef4444; background: #fff; padding: 15px; border-radius: 8px; border: 1px solid #fca5a5; max-width: 800px; overflow: auto; text-align: left; font-size: 12px;"></pre>
        <button onclick="window.location.reload()" style="margin-top: 20px; padding: 10px 20px; background: #4f46e5; color: white; border: none; border-radius: 6px; cursor: pointer;">Reload App</button>
    </div>

    <script>
      window.onerror = function(msg, url, line, col, error) {
         if (msg && msg.toString().includes('ResizeObserver')) return;
         if (msg && msg.toString().includes('Script error')) return;
         
         const loader = document.getElementById('root');
         const overlay = document.getElementById('error-overlay');
         const msgEl = document.getElementById('error-message');
         
         const rootHasContent = loader && loader.children.length > 0 && !loader.innerHTML.includes('Loading ProCount');
         
         if (!rootHasContent) {
             if(loader) loader.style.display = 'none';
             if(overlay) overlay.style.display = 'flex';
             if(msgEl) msgEl.textContent = msg + '\n\n' + (error ? error.stack : '');
         } else {
             console.error(msg, error);
         }
         return false;
      };
      
      const style = document.createElement('style');
      style.innerHTML = `@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }`;
      document.head.appendChild(style);

      // Register Service Worker manually to ensure PWA works
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/sw.js').then(registration => {
            console.log('SW registered: ', registration);
          }).catch(registrationError => {
            console.log('SW registration failed: ', registrationError);
          });
        });
      }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
    <script type="module" src="/index.tsx"></script>
  </body>
</html>
